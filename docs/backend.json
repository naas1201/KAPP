
{
  "entities": {
    "User": {
      "title": "User",
      "type": "object",
      "description": "Represents a registered user in the system, could be a doctor or admin staff.",
      "properties": {
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user.",
          "enum": ["admin", "doctor"]
        }
      },
      "required": ["email", "role"]
    },
    "Patient": {
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient in the Castillo Health & Aesthetics system.",
      "properties": {
        "firstName": {
          "type": "string",
          "description": "Patient's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Patient's last name."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Patient's date of birth.",
          "format": "date"
        },
        "email": {
          "type": "string",
          "description": "Patient's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Patient's phone number."
        },
        "address": {
          "type": "string",
          "description": "Patient's address."
        },
        "medicalHistory": {
          "type": "string",
          "description": "Summary of the patient's medical history."
        },
        "aestheticGoals": {
          "type": "string",
          "description": "Patient's aesthetic goals."
        },
        "relatedPatientIds": {
          "type": "array",
          "description": "References to other related patients (e.g., family members). (Relationship: Patient N:N Patient)",
          "items": {
            "type": "string"
          }
        },
        "appointmentCount": {
            "type": "number",
            "description": "Total number of appointments for this patient."
        }
      },
      "required": [
        "firstName",
        "lastName",
        "dateOfBirth",
        "email",
        "phone"
      ]
    },
    "Appointment": {
      "title": "Appointment",
      "type": "object",
      "description": "Represents an appointment booking.",
      "properties": {
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N Appointment)"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. (Relationship: Doctor 1:N Appointment)"
        },
        "serviceType": {
          "type": "string",
          "description": "Type of service for the appointment (e.g., General Medicine, Aesthetic Treatment)."
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time of the appointment.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the appointment (e.g., pending, confirmed, cancelled).",
          "enum": ["pending", "confirmed", "cancelled"]
        },
        "notes": {
          "type": "string",
          "description": "Any notes related to the appointment."
        }
      },
      "required": [
        "patientId",
        "doctorId",
        "serviceType",
        "dateTime",
        "status"
      ]
    },
    "TreatmentRecord": {
      "title": "TreatmentRecord",
      "type": "object",
      "description": "Represents a treatment record for a patient.",
      "properties": {
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N TreatmentRecord)"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. (Relationship: Doctor 1:N TreatmentRecord)"
        },
        "treatmentType": {
          "type": "string",
          "description": "Type of treatment (e.g., Botox, Consultation)."
        },
        "date": {
          "type": "string",
          "description": "Date of the treatment.",
          "format": "date"
        },
        "details": {
          "type": "string",
          "description": "Details of the treatment performed."
        },
        "prescriptionIds": {
          "type": "array",
          "description": "References to prescriptions associated with the treatment. (Relationship: TreatmentRecord 1:N Prescription)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "patientId",
        "doctorId",
        "treatmentType",
        "date"
      ]
    },
    "Doctor": {
      "title": "Doctor",
      "type": "object",
      "description": "Represents a doctor in the system.",
      "properties": {
        "firstName": {
          "type": "string",
          "description": "Doctor's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Doctor's last name."
        },
        "specialization": {
          "type": "string",
          "description": "Doctor's specialization."
        },
        "email": {
          "type": "string",
          "description": "Doctor's email address.",
          "format": "email"
        },
        "onboardingCompleted": {
          "type": "boolean",
          "description": "Flag to check if doctor has completed the initial service selection."
        }
      },
      "required": [
        "firstName",
        "lastName",
        "specialization",
        "email"
      ]
    },
    "Prescription": {
      "title": "Prescription",
      "type": "object",
      "description": "Represents a prescription.",
      "properties": {
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. (Relationship: Doctor 1:N Prescription)"
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N Prescription)"
        },
        "drugName": {
          "type": "string",
          "description": "Name of the prescribed drug."
        },
        "dosage": {
          "type": "string",
          "description": "Dosage of the drug."
        },
        "frequency": {
          "type": "string",
          "description": "Frequency of the drug intake."
        },
        "notes": {
          "type": "string",
          "description": "Additional notes on the prescription."
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the prescription was created."
        },
        "expiresAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the prescription expires."
        }
      },
      "required": [
        "doctorId",
        "patientId",
        "drugName",
        "dosage",
        "frequency",
        "createdAt",
        "expiresAt"
      ]
    },
    "Lead": {
      "title": "Lead",
      "type": "object",
      "description": "Represents a lead captured through the lead capture form.",
      "properties": {
        "firstName": {
          "type": "string",
          "description": "Lead's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Lead's last name."
        },
        "email": {
          "type": "string",
          "description": "Lead's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Lead's phone number."
        },
        "source": {
          "type": "string",
          "description": "Source of the lead (e.g., Website, Messenger)."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient, if the lead converted. (Relationship: Lead 1:1 Patient)"
        }
      },
      "required": [
        "firstName",
        "lastName",
        "email",
        "phone",
        "source"
      ]
    },
    "FAQ": {
      "title": "FAQ",
      "type": "object",
      "description": "Represents a frequently asked question for a specific treatment.",
      "properties": {
        "treatmentName": {
          "type": "string",
          "description": "Name of the treatment the FAQ is related to."
        },
        "question": {
          "type": "string",
          "description": "The question asked."
        },
        "answer": {
          "type": "string",
          "description": "The answer to the question."
        }
      },
      "required": [
        "treatmentName",
        "question",
        "answer"
      ]
    },
    "VideoCall": {
      "title": "VideoCall",
      "type": "object",
      "description": "Represents a WebRTC video call session.",
      "properties": {
        "offer": {
          "type": "object",
          "description": "The SDP offer from the calling peer."
        },
        "answer": {
          "type": "object",
          "description": "The SDP answer from the receiving peer."
        },
        "doctorCandidates": {
          "type": "array",
          "items": { "type": "object" },
          "description": "ICE candidates from the doctor."
        },
        "patientCandidates": {
          "type": "array",
          "items": { "type": "object" },
          "description": "ICE candidates from the patient."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "active", "completed", "declined"]
        }
      }
    },
    "Treatment": {
      "title": "Treatment",
      "type": "object",
      "description": "Represents a master treatment/procedure offered by the clinic.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the treatment."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the treatment."
        },
        "category": {
          "type": "string",
          "description": "Category of the treatment (e.g., 'Aesthetic', 'General Medicine')."
        }
      },
      "required": ["name", "description", "category"]
    },
    "DoctorService": {
      "title": "DoctorService",
      "type": "object",
      "description": "Links a doctor to a master treatment and specifies their price.",
      "properties": {
        "treatmentId": {
          "type": "string",
          "description": "Reference to the master Treatment document."
        },
        "price": {
          "type": "number",
          "description": "The price this specific doctor charges for the treatment."
        },
        "providesService": {
          "type": "boolean",
          "description": "Whether the doctor provides this service."
        }
      },
      "required": ["treatmentId", "price", "providesService"]
    },
    "ChatRoom": {
        "title": "ChatRoom",
        "type": "object",
        "description": "Represents a private chat room between a doctor and a patient.",
        "properties": {
            "doctorId": { "type": "string", "description": "The UID of the doctor." },
            "patientId": { "type": "string", "description": "The UID of the patient." },
            "lastMessageText": { "type": "string", "description": "The text of the last message sent." },
            "lastActivity": { "type": "string", "format": "date-time", "description": "Timestamp of the last activity." },
            "status": { "type": "string", "enum": ["open", "closed"], "description": "Status of the chat room." },
            "doctorUnreadCount": { "type": "number", "description": "Number of unread messages for the doctor." },
            "patientUnreadCount": { "type": "number", "description": "Number of unread messages for the patient." },
            "participants": { "type": "array", "items": { "type": "string" }, "description": "Array containing the UIDs of the doctor and patient." }
        },
        "required": ["doctorId", "patientId", "lastActivity", "status", "participants"]
    },
    "ChatMessage": {
        "title": "ChatMessage",
        "type": "object",
        "description": "Represents a single message within a chat room.",
        "properties": {
            "senderId": { "type": "string", "description": "The UID of the message sender." },
            "text": { "type": "string", "description": "The text content of the message." },
            "imageUrl": { "type": "string", "description": "URL of an image attachment." },
            "fileUrl": { "type": "string", "description": "URL of a file attachment." },
            "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp when the message was created." },
            "readByPatient": { "type": "boolean", "description": "True if the patient has read the message." }
        },
        "required": ["senderId", "createdAt"]
    },
    "Report": {
      "title": "Report",
      "type": "object",
      "description": "Represents a report filed by a doctor against a patient.",
      "properties": {
        "reporterId": {
          "type": "string",
          "description": "The UID of the user filing the report (a doctor)."
        },
        "reportedId": {
          "type": "string",
          "description": "The UID of the user being reported (a patient)."
        },
        "reason": {
          "type": "string",
          "description": "The reason for the report."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the report was created."
        }
      },
      "required": ["reporterId", "reportedId", "reason", "createdAt"]
    },
    "Rating": {
      "title": "Rating",
      "type": "object",
      "description": "Represents a rating for a consultation.",
      "properties": {
        "consultationId": {
          "type": "string",
          "description": "The ID of the consultation/call being rated."
        },
        "ratedId": {
          "type": "string",
          "description": "The UID of the user being rated (doctor or patient)."
        },
        "raterId": {
          "type": "string",
          "description": "The UID of the user giving the rating."
        },
        "rating": {
          "type": "number",
          "description": "The rating value (e.g., 1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment with the rating."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the rating was submitted."
        }
      },
      "required": ["consultationId", "ratedId", "raterId", "rating", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "collections": [
      {
        "path": "/users/{userId}",
        "schema": {
          "$ref": "#/entities/User"
        },
        "description": "Stores user roles (admin, doctor). The document ID is the user's auth UID."
      },
      {
        "path": "/patients/{patientId}",
        "schema": {
          "$ref": "#/entities/Patient"
        },
        "description": "Stores patient profiles. The document ID is the patient's auth UID."
      },
      {
        "path": "/patients/{patientId}/appointments/{appointmentId}",
        "schema": {
          "$ref": "#/entities/Appointment"
        },
        "description": "Subcollection for a patient's appointments."
      },
      {
        "path": "/patients/{patientId}/treatmentRecords/{recordId}",
        "schema": {
          "$ref": "#/entities/TreatmentRecord"
        },
        "description": "Subcollection for a patient's treatment history."
      },
      {
        "path": "/patients/{patientId}/prescriptions/{prescriptionId}",
        "schema": {
          "$ref": "#/entities/Prescription"
        },
        "description": "Subcollection for a patient's prescriptions."
      },
      {
        "path": "/doctors/{doctorId}",
        "schema": {
          "$ref": "#/entities/Doctor"
        },
        "description": "Stores doctor profiles. The document ID is the doctor's auth UID."
      },
      {
        "path": "/doctors/{doctorId}/authorizedPatients/{patientId}",
        "schema": {},
        "description": "An empty document here acts as an ACL entry, granting the doctor (identified by doctorId) access to the patient (identified by patientId). This allows for efficient security rule checks without reading patient documents."
      },
       {
        "path": "/doctors/{doctorId}/services/{treatmentId}",
        "schema": {
          "$ref": "#/entities/DoctorService"
        },
        "description": "Stores the services and pricing a specific doctor offers."
      },
      {
        "path": "/leads/{leadId}",
        "schema": {
          "$ref": "#/entities/Lead"
        },
        "description": "Stores leads from contact forms. Accessible by staff roles."
      },
      {
        "path": "/faqs/{faqId}",
        "schema": {
          "$ref": "#/entities/FAQ"
        },
        "description": "Stores frequently asked questions. Publicly readable."
      },
       {
        "path": "/video-calls/{roomId}",
        "schema": {
          "$ref": "#/entities/VideoCall"
        },
        "description": "Temporary signaling collection for WebRTC video calls."
      },
      {
        "path": "/prescriptions/{prescriptionId}",
        "schema": {
            "$ref": "#/entities/Prescription"
        },
        "description": "Denormalized collection of all prescriptions for easier querying by staff for expiry."
      },
      {
        "path": "/treatments/{treatmentId}",
        "schema": {
          "$ref": "#/entities/Treatment"
        },
        "description": "Master list of all treatments offered by the clinic. Managed by Admin."
      },
      {
          "path": "/chatRooms/{roomId}",
          "schema": {
              "$ref": "#/entities/ChatRoom"
          },
          "description": "Top-level collection for chat rooms."
      },
      {
          "path": "/chatRooms/{roomId}/messages/{messageId}",
          "schema": {
              "$ref": "#/entities/ChatMessage"
          },
          "description": "Subcollection for messages within a chat room."
      },
      {
        "path": "/reports/{reportId}",
        "schema": {
          "$ref": "#/entities/Report"
        },
        "description": "Collection for reports filed by doctors. Only accessible by Admins."
      },
      {
        "path": "/ratings/{ratingId}",
        "schema": {
          "$ref": "#/entities/Rating"
        },
        "description": "Collection for all consultation ratings."
      }
    ]
  }
}
